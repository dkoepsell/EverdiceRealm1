{
  "caml_version": "2.0",

  "meta": {
    "id": "adventure.lost-temple.history",
    "title": "The Lost Temple",
    "created_utc": "2026-01-09T06:00:00Z",
    "authors": ["Everdice DM Toolkit"],
    "levels": { "min": 1, "max": 5 },
    "tags": ["fantasy", "temple", "mystery", "ruins"]
  },

  "world": {
    "entities": {
      "characters": [
        { "id": "PC_Party", "kind": "character", "pc": true },

        { "id": "NPC_EldrinGhost", "kind": "character", "name": "Eldrin the Lost", "species": "Ghost" },
        { "id": "NPC_Loxley", "kind": "character", "name": "Professor Loxley", "species": "Human" },
        { "id": "NPC_Anara", "kind": "character", "name": "Anara, Protector of the Temple", "species": "Spirit" },
        { "id": "NPC_Tarin", "kind": "character", "name": "Tarin the Guide", "species": "Elf" }
      ],

      "locations": [
        { "id": "LOC_Entrance", "kind": "location", "name": "Temple Entrance" },
        { "id": "LOC_Corridor", "kind": "location", "name": "Echoing Corridor" },
        { "id": "LOC_Sanctum", "kind": "location", "name": "Inner Sanctum" },
        { "id": "LOC_Library", "kind": "location", "name": "Forgotten Library" },
        { "id": "LOC_Hidden", "kind": "location", "name": "Hidden Chamber" }
      ],

      "items": [
        { "id": "ITEM_Amulet", "kind": "item", "name": "Amulet of the Lost", "rarity": "uncommon" },
        { "id": "ITEM_Scroll", "kind": "item", "name": "Scroll of Ancient Wisdom", "rarity": "uncommon" },
        { "id": "ITEM_Staff", "kind": "item", "name": "Gilded Staff", "rarity": "rare" }
      ],

      "factions": []
    },

    "connections": [
      { "id": "CONN_Entrance_Corridor", "from": "LOC_Entrance", "to": "LOC_Corridor", "mode": "hall" },
      { "id": "CONN_Corridor_Sanctum", "from": "LOC_Corridor", "to": "LOC_Sanctum", "mode": "archway" },
      { "id": "CONN_Corridor_Library", "from": "LOC_Corridor", "to": "LOC_Library", "mode": "side_passage" },
      { "id": "CONN_Sanctum_Hidden", "from": "LOC_Sanctum", "to": "LOC_Hidden", "mode": "concealed" }
    ]
  },

  "state": {
    "facts": [
      { "id": "STATE_Anara_Active", "bearer": "NPC_Anara", "type": "active", "value": true },
      { "id": "STATE_Loxley_Hostile", "bearer": "NPC_Loxley", "type": "hostile", "value": true },
      { "id": "STATE_HiddenChamber_Known", "bearer": "LOC_Hidden", "type": "discovered", "value": false },
      { "id": "STATE_Artifact_Possessed", "bearer": "ITEM_Amulet", "type": "possessed", "value": false },
      { "id": "STATE_TempleHistory_Known", "bearer": "LOC_Library", "type": "knowledge_uncovered", "value": false }
    ]
  },

  "roles": {
    "assignments": [
      {
        "id": "ROLE_Guardian",
        "role": "TempleGuardian",
        "holder": "NPC_Anara",
        "revocation": {
          "any": [
            { "lhs": "state[STATE_Anara_Active].value", "op": "==", "rhs": false }
          ]
        }
      }
    ]
  },

  "processes": {
    "catalog": [
      {
        "id": "PROC_Ghost_Encounter",
        "type": "social",
        "timebox": {
          "id": "TB_Ghost",
          "label": "Ghost Encounter"
        },
        "location": "LOC_Corridor",
        "participants": ["PC_Party", "NPC_EldrinGhost"],
        "notes": "Eldrin attempts to communicate his fate and knowledge."
      },
      {
        "id": "PROC_Scholar_Conflict",
        "type": "combat",
        "timebox": {
          "id": "TB_Scholar",
          "label": "Scholar Conflict"
        },
        "location": "LOC_Library",
        "participants": ["PC_Party", "NPC_Loxley"],
        "notes": "Professor Loxley attacks intruders."
      },
      {
        "id": "PROC_Guardian_Battle",
        "type": "combat",
        "timebox": {
          "id": "TB_Guardian",
          "label": "Guardian Battle"
        },
        "location": "LOC_Sanctum",
        "participants": ["PC_Party", "NPC_Anara"],
        "notes": "Anara tests the party's worth."
      }
    ]
  },

  "transitions": {
    "changes": [
      {
        "id": "TR_Library_Resolved",
        "caused_by": "PROC_Scholar_Conflict",
        "ops": [
          { "op": "update_state", "state_id": "STATE_Loxley_Hostile", "value": false },
          { "op": "update_state", "state_id": "STATE_TempleHistory_Known", "value": true }
        ]
      },
      {
        "id": "TR_Sanctum_Cleared",
        "caused_by": "PROC_Guardian_Battle",
        "ops": [
          { "op": "update_state", "state_id": "STATE_Anara_Active", "value": false },
          { "op": "update_state", "state_id": "STATE_HiddenChamber_Known", "value": true }
        ]
      },
      {
        "id": "TR_Artifact_Claimed",
        "caused_by": "TR_Sanctum_Cleared",
        "ops": [
          { "op": "update_state", "state_id": "STATE_Artifact_Possessed", "value": true }
        ]
      }
    ]
  },

  "snapshots": {
    "timeline": [
      {
        "id": "SNAP_Temple_Revealed",
        "time_utc": "2026-01-09T08:00:00Z",
        "world_hash": "placeholder",
        "state_hash": "placeholder",
        "roles_hash": "placeholder",
        "derived_from_transition": "TR_Artifact_Claimed",
        "narration": "With the guardian defeated and the hidden chamber revealed, the temple finally yields its long-guarded secrets."
      }
    ]
  }
}
