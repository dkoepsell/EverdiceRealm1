Query: select "id", "username", "password", "email", "display_name", "last_login", "created_at" from "users" where "users"."id" = $1 -- params: [2]
Dice roll request body: {
  diceType: 'd20',
  count: 1,
  modifier: 3,
  purpose: 'Persuasion Check for "Attempt to communicate with the Treant"',
  characterId: null
}
11:59:08 AM [express] POST /api/dice/roll 500 in 48ms :: {"message":"Failed to process dice roll"}
Query: select "id", "username", "password", "email", "display_name", "last_login", "created_at" from "users" where "users"."id" = $1 -- params: [2]
Query: select "id", "user_id", "title", "description", "difficulty", "narrative_style", "current_session", "current_turn_user_id", "is_turn_based", "turn_time_limit", "turn_started_at", "xp_reward", "is_archived", "is_completed", "completed_at", "is_published", "published_at", "deployment_code", "is_private", "max_players", "created_at", "updated_at" from "campaigns" where "campaigns"."id" = $1 -- params: [8]
Query: select "id", "campaign_id", "session_number", "title", "narrative", "location", "choices", "session_xp_reward", "is_completed", "completed_at", "created_at", "updated_at" from "campaign_sessions" where "campaign_sessions"."campaign_id" = $1 order by "campaign_sessions"."session_number" asc -- params: [8]
Query: select "id", "user_id", "character_id", "dice_type", "result", "modifier", "count", "purpose", "created_at" from "dice_rolls" where "dice_rolls"."user_id" = $1 order by "dice_rolls"."created_at" desc limit $2 -- params: [2, 5]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [8]
Query: select "id", "user_id", "name", "race", "class", "level", "background", "alignment", "strength", "dexterity", "constitution", "intelligence", "wisdom", "charisma", "hit_points", "max_hit_points", "armor_class", "experience", "gold", "skills", "equipment", "appearance", "portrait_url", "background_story", "created_at", "updated_at" from "characters" where "characters"."id" = $1 -- params: []
Query: select "id", "username", "password", "email", "display_name", "last_login", "created_at" from "users" where "users"."id" = $1 -- params: [2]
Query: select "id", "user_id", "title", "description", "difficulty", "narrative_style", "current_session", "current_turn_user_id", "is_turn_based", "turn_time_limit", "turn_started_at", "xp_reward", "is_archived", "is_completed", "completed_at", "is_published", "published_at", "deployment_code", "is_private", "max_players", "created_at", "updated_at" from "campaigns"
Query: select "id", "username", "password", "email", "display_name", "last_login", "created_at" from "users" where "users"."id" = $1 -- params: [2]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [3]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [4]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [5]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [7]
Query: select "id", "campaign_id", "session_number", "title", "narrative", "location", "choices", "session_xp_reward", "is_completed", "completed_at", "created_at", "updated_at" from "campaign_sessions" where "campaign_sessions"."campaign_id" = $1 order by "campaign_sessions"."session_number" asc -- params: [8]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [1]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [8]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [6]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [2]
11:59:18 AM [express] GET /api/campaigns 304 in 435ms :: [{"id":3,"userId":2,"title":"Veils of the Ve…
11:59:18 AM [express] GET /api/campaigns/8/sessions 304 in 383ms :: [{"id":124,"campaignId":8,"sessio…
Failed to parse OpenAI response: Error: Invalid response structure
    at <anonymous> (/home/runner/workspace/server/routes.ts:1302:17)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Raw response: {
  "narrative": "The air around you is thick with mystery. As you stand in the mist-laden valley, echoes of an ancient land seem to whisper through the trees. The chill is invigorating, and your senses are heightened, aware of your surroundings but uncertain of where you are. The soil beneath your feet bears the marks of what seems to be an ancient roadway, overgrown yet discernible. A distant growl resonates; it sounds like a large creature that might be lurking just beyond the treeline. Your recent teamwork, overcoming a perilous chasm, has brought you to this strange and uncharted frontier, its secrets beckoning exploration.",
  "location": "Misty Valley",
  "storyProgression": {
    "mainPlotAdvancement": "You have arrived in the Misty Valley, which seems to hold ancient secrets and dangerous creatures. This advancement suggests a pivotal location tied to the main plot's mystery.",
    "consequencesShown": "The party's successful crossing of the chasm has led to this new, foreboding location, showcasing their resilience and determination.",
    "threadsResolved": [],
    "newThreads": ["What lies beyond the mist?", "What creature lurks in the shadows?"]
  },
  "choices": [
    {
      "action": "Investigate the ancient roadway",
      "description": "Examine the overgrown path, searching for clues about who created it and what purpose it served. This could unveil historical insights or lead to new discoveries.",
      "requiresDiceRoll": true,
      "diceType": "d20",
      "rollDC": 15,
      "abilityType": "intelligence",
      "rollModifier": 2,
      "rollPurpose": "Determine the amount and quality of information gathered about the roadway.",
      "storyImpact": "moderate"
    },
    {
      "action": "Scout the perimeter of the valley",
      "description": "Move stealthily around the valley's edge to locate the source of the growl. This scout could provide a tactical advantage or reveal approaching danger.",
      "requiresDiceRoll": true,
      "diceType": "d20",
      "rollDC": 12,
      "abilityType": "dexterity",
      "rollModifier": 3,
      "rollPurpose": "Determine how well you remain undetected by potential threats.",
      "storyImpact": "major"
    },
    {
      "action": "Set up a temporary camp",
      "description": "Find a defensible position to rest and plan your next move. This could boost party morale and recovery at the risk of being discovered by whatever dwells here.",
      "requiresDiceRoll": true,
      "diceType": "d20",
      "rollDC": 10,
      "abilityType": "wisdom",
      "rollModifier": 1,
      "rollPurpose": "Determine the quality of the camp setup for safety and restfulness.",
      "storyImpact": "minor"
    }
  ]
}
11:59:19 AM [express] POST /api/campaigns/advance-story 500 in 8599ms :: {"message":"Failed to parse …
Query: select "id", "username", "password", "email", "display_name", "last_login", "created_at" from "users" where "users"."id" = $1 -- params: [2]
Query: select "id", "username", "password", "email", "display_name", "last_login", "created_at" from "users" where "users"."id" = $1 -- params: [2]
Query: select "id", "campaign_id", "session_number", "title", "narrative", "location", "choices", "session_xp_reward", "is_completed", "completed_at", "created_at", "updated_at" from "campaign_sessions" where "campaign_sessions"."campaign_id" = $1 order by "campaign_sessions"."session_number" asc -- params: [8]
Query: select "id", "user_id", "title", "description", "difficulty", "narrative_style", "current_session", "current_turn_user_id", "is_turn_based", "turn_time_limit", "turn_started_at", "xp_reward", "is_archived", "is_completed", "completed_at", "is_published", "published_at", "deployment_code", "is_private", "max_players", "created_at", "updated_at" from "campaigns"
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [3]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [4]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [5]
11:59:34 AM [express] GET /api/campaigns/8/sessions 304 in 394ms :: [{"id":124,"campaignId":8,"sessio…
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [7]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [1]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [8]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [6]
Query: select "users"."id", "users"."username", "users"."display_name", "campaign_participants"."joined_at", "campaign_participants"."role", "campaign_participants"."is_active" from "campaign_participants" inner join "users" on "campaign_participants"."user_id" = "users"."id" where "campaign_participants"."campaign_id" = $1 -- params: [2]
11:59:34 AM [express] GET /api/campaigns 304 in 596ms :: [{"id":3,"userId":2,"title":"Veils of the Ve…
